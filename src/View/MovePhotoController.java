package View;

import Model.Album;
import Model.Photo;
import Model.User;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;

import javafx.scene.control.Button;

import javafx.scene.control.ListView;

import javafx.scene.input.MouseEvent;
import javafx.stage.Stage;
/**
* MovePhotoController is the class associated with the screen for moving photos
* from one album to another album. This action will delete a photo from the current album
* and add it to the selected destination album's list of photos
* @author  Tom Raybould & Mike Tomkowich
*/
public class MovePhotoController {
	@FXML
	private ListView<String> destList;
	@FXML
	private Button moveButton;
	
	private Stage currentStage;
    
    private ObservableList<String> obslist;
    
    private String selectedAlbum;
    
    /**
     * Loads current screen and data associated with the screen
     * 
     * @param mainStage stage that is passed to be loaded
     * 
     * @return void
     */
	
	public void start(Stage mainStage){
		this.update();
		currentStage = mainStage;
		
		destList
        .getSelectionModel()
        .selectedItemProperty()
        .addListener(
        (obs , oldVal, newVal) -> 
        	{this.selectedAlbum = destList.getSelectionModel().getSelectedItem();});
			// shoulnt be called selected user
	}
	/**
     * Updates data associated with screen
     * 
     * @return void
     */
	public void update(){
		obslist = FXCollections.observableArrayList();
		
		for(Album a : User.getCurrentUser().getAlbumList()){
			String s = new String(a.getName());
			if(s==a.getName()){
				System.out.println("not working");
			}
			obslist.add(s);
		}
		
		destList.setItems(obslist);
	}
	
	/**
     * Handles button and action events that occur on this screen
     * 
     * @param e an Action event
     * 
     * @return void
     */
	@FXML
	public void handle(ActionEvent e) {
		// TODO Autogenerated
		Button b = (Button)e.getSource();
    	if(b == moveButton){
    		System.out.println(selectedAlbum);
    		System.out.println(Photo.getCurrentPhoto().toString());
    		
    		for(Album a: User.getCurrentUser().getAlbumList()){
    			if(a.getName().equals(selectedAlbum)){
    				//add to new album before removing from old
    				a.addPhotoToAlbum(Photo.getCurrentPhoto());
 
    				Album.getCurrentAlbum().removePhotoFromAlbum(Photo.getCurrentPhoto());
    				//remove method adjusts count

    			}
    		}
    		this.update();
			currentStage.close();
			//doesnt need to be in the loop
    	}
    	
	}
}
